<!DOCTYPE html>
<html lang="en">

<head>
  <title>
  Lambda Functions with Rust and CDK · Manuel Martinez
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Manuel Martinez">
<meta name="description" content="
  Introduction
  
    
    Link to heading
  

This post is a follow-up to the previous post on Lambda Functions with Go and CDK. In this post, we&rsquo;ll go through deploying a Rust-based AWS Lambda function using the AWS Cloud Development Kit (CDK). We&rsquo;ll focus on the developer workflow: how to get started, wire up your Rust Lambda, and use CDK to manage your infrastructure as code. If you&rsquo;re already familiar with Lambda as a service, this guide will help you get productive with Rust and CDK quickly.">
<meta name="keywords" content="blog,developer,personal">



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Lambda Functions with Rust and CDK">
  <meta name="twitter:description" content="Introduction Link to heading This post is a follow-up to the previous post on Lambda Functions with Go and CDK. In this post, we’ll go through deploying a Rust-based AWS Lambda function using the AWS Cloud Development Kit (CDK). We’ll focus on the developer workflow: how to get started, wire up your Rust Lambda, and use CDK to manage your infrastructure as code. If you’re already familiar with Lambda as a service, this guide will help you get productive with Rust and CDK quickly.">

<meta property="og:url" content="https://manmartgarc.github.io/posts/tech-support/rust-lambda/">
  <meta property="og:site_name" content="Manuel Martinez">
  <meta property="og:title" content="Lambda Functions with Rust and CDK">
  <meta property="og:description" content="Introduction Link to heading This post is a follow-up to the previous post on Lambda Functions with Go and CDK. In this post, we’ll go through deploying a Rust-based AWS Lambda function using the AWS Cloud Development Kit (CDK). We’ll focus on the developer workflow: how to get started, wire up your Rust Lambda, and use CDK to manage your infrastructure as code. If you’re already familiar with Lambda as a service, this guide will help you get productive with Rust and CDK quickly.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-07-27T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-07-27T00:00:00+00:00">
    <meta property="article:tag" content="Aws">
    <meta property="article:tag" content="Cloud">
    <meta property="article:tag" content="Rust">
    <meta property="article:tag" content="Cdk">




<link rel="canonical" href="https://manmartgarc.github.io/posts/tech-support/rust-lambda/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.min.6445a802b9389c9660e1b07b724dcf5718b1065ed2d71b4eeaf981cc7cc5fc46.css" integrity="sha256-ZEWoArk4nJZg4bB7ck3PVxixBl7S1xtO6vmBzHzF/EY=" crossorigin="anonymous" media="screen" />






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css" integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin="anonymous" media="screen" />
  



 




<link rel="icon" type="image/svg+xml" href="/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/images/favicon.ico" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicon.ico" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="https://manmartgarc.github.io/">
      Manuel Martinez
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/about/">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Posts</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/projects/">Projects</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/cv/">CV</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="https://manmartgarc.github.io/posts/tech-support/rust-lambda/">
              Lambda Functions with Rust and CDK
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2025-07-27T00:00:00Z">
                July 27, 2025
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              7-minute read
            </span>
          </div>
          
          <div class="categories">
  <i class="fa-solid fa-folder" aria-hidden="true"></i>
    <a href="/categories/tech-support/">Tech Support</a></div>

          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/aws/">Aws</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/cloud/">Cloud</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/rust/">Rust</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/cdk/">Cdk</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <h2 id="introduction">
  Introduction
  <a class="heading-link" href="#introduction">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>This post is a follow-up to the previous post on <a href="/posts/tech-support/go-lambda" >Lambda Functions with Go and CDK</a>. In this post, we&rsquo;ll go through deploying a Rust-based AWS Lambda function using the AWS Cloud Development Kit (CDK). We&rsquo;ll focus on the developer workflow: how to get started, wire up your Rust Lambda, and use CDK to manage your infrastructure as code. If you&rsquo;re already familiar with Lambda as a service, this guide will help you get productive with Rust and CDK quickly.</p>
<p>I want to share all the documentation I found useful while writing this post up front, so you can get started quickly. The main resources are:</p>
<ul>
<li><strong>AWS Docs</strong>:
<ol>
<li><a href="https://docs.aws.amazon.com/sdk-for-rust/latest/dg/lambda.html"  class="external-link" target="_blank" rel="noopener">Creating Lambda functions in the AWS SDK for Rust</a></li>
<li><a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-rust.html"  class="external-link" target="_blank" rel="noopener">Building Lambda Functions with Rust</a></li>
<li><a href="https://docs.aws.amazon.com/sdk-for-rust/latest/dg/testing-smithy-mocks.html"  class="external-link" target="_blank" rel="noopener">Unit testing with aws-smithy-mocks in the AWS SDK for Rust</a></li>
</ol>
</li>
<li><strong>Code Packages</strong>:
<ol>
<li><a href="https://github.com/awslabs/aws-lambda-rust-runtime"  class="external-link" target="_blank" rel="noopener">Rust Runtime for AWS Lambda</a></li>
<li><a href="https://github.com/cdklabs/aws-lambda-rust"  class="external-link" target="_blank" rel="noopener">@cdklabs/aws-lambda-rust</a></li>
<li><a href="https://github.com/awsdocs/aws-doc-sdk-examples/tree/main/rustv1"  class="external-link" target="_blank" rel="noopener">Rust SDK for AWS Examples</a></li>
<li><a href="https://www.cargo-lambda.info/"  class="external-link" target="_blank" rel="noopener">Cargo Lambda</a></li>
</ol>
</li>
</ul>
<h2 id="why-rust">
  Why Rust?
  <a class="heading-link" href="#why-rust">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Rust is a modern, memory-safe, and high-performance language. For Lambda functions, Rust offers <a href="https://maxday.github.io/lambda-perf/"  class="external-link" target="_blank" rel="noopener">fast cold starts and low memory overhead</a>, making it a great fit for event-driven workloads with high volume and low latency. With the growing ecosystem around <a href="https://www.cargo-lambda.info/"  class="external-link" target="_blank" rel="noopener">cargo-lambda</a> and the <a href="https://github.com/cdklabs/aws-lambda-rust"  class="external-link" target="_blank" rel="noopener">@cdklabs/aws-lambda-rust</a> CDK construct, deploying Rust Lambdas is getting easier every day.</p>
<h2 id="project-structure">
  Project Structure
  <a class="heading-link" href="#project-structure">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>We&rsquo;ll use a monorepo layout, with the CDK app (TypeScript) and the Rust Lambda function side by side:</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>my-cdk-rust-lambda/
</span></span><span style="display:flex;"><span>├── rust_lambda/              # Rust Lambda function
</span></span><span style="display:flex;"><span>│   ├── src/
</span></span><span style="display:flex;"><span>│   ├── Cargo.toml
</span></span><span style="display:flex;"><span>│   └── ...
</span></span><span style="display:flex;"><span>├── lib/
</span></span><span style="display:flex;"><span>│   └── lambda-rust-stack.ts  # CDK stack definition
</span></span><span style="display:flex;"><span>├── bin/
</span></span><span style="display:flex;"><span>│   └── lambda-rust.ts        # CDK app entrypoint
</span></span><span style="display:flex;"><span>├── package.json
</span></span><span style="display:flex;"><span>├── cdk.json
</span></span><span style="display:flex;"><span>└── ...
</span></span></code></pre></div><h2 id="setting-up-the-cdk-project">
  Setting Up the CDK Project
  <a class="heading-link" href="#setting-up-the-cdk-project">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Start by making sure you have the AWS CDK CLI installed. If you don&rsquo;t have it yet, you can install it globally with:</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>npm install -g aws-cdk
</span></span></code></pre></div><p>You also need to <a href="https://www.cargo-lambda.info/guide/installation.html"  class="external-link" target="_blank" rel="noopener">install cargo lambda</a> to easily create the Rust package for your Lambda function.</p>
<ol>
<li>
<p><strong>Initialize a new CDK project:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir my-cdk-rust-lambda <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> cd my-cdk-rust-lambda
</span></span><span style="display:flex;"><span>cdk init app --language typescript
</span></span><span style="display:flex;"><span>npm install @cdklabs/aws-lambda-rust aws-cdk-lib constructs
</span></span></code></pre></div></li>
<li>
<p><strong>Add your Rust Lambda code:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cargo lambda new rust_lambda
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># Write your Lambda logic in rust_lambda/src/main.rs</span>
</span></span></code></pre></div></li>
</ol>
<h2 id="defining-the-stack">
  Defining the Stack
  <a class="heading-link" href="#defining-the-stack">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Here&rsquo;s a minimal CDK stack that deploys a Rust Lambda and an S3 bucket, wiring the bucket to trigger the Lambda on object creation:</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#ff7b72">import</span> <span style="color:#ff7b72;font-weight:bold">*</span> <span style="color:#ff7b72">as</span> rust <span style="color:#ff7b72">from</span> <span style="color:#a5d6ff">&#39;@cdklabs/aws-lambda-rust&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">import</span> <span style="color:#ff7b72;font-weight:bold">*</span> <span style="color:#ff7b72">as</span> cdk <span style="color:#ff7b72">from</span> <span style="color:#a5d6ff">&#39;aws-cdk-lib&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">import</span> <span style="color:#ff7b72;font-weight:bold">*</span> <span style="color:#ff7b72">as</span> s3 <span style="color:#ff7b72">from</span> <span style="color:#a5d6ff">&#39;aws-cdk-lib/aws-s3&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">import</span> <span style="color:#ff7b72;font-weight:bold">*</span> <span style="color:#ff7b72">as</span> s3events <span style="color:#ff7b72">from</span> <span style="color:#a5d6ff">&#39;aws-cdk-lib/aws-s3-notifications&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">import</span> { Construct } <span style="color:#ff7b72">from</span> <span style="color:#a5d6ff">&#39;constructs&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">export</span> <span style="color:#ff7b72">class</span> LambdaRustStack <span style="color:#ff7b72">extends</span> cdk.Stack {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">private</span> <span style="color:#ff7b72">readonly</span> rustHandler: <span style="color:#ff7b72">rust.RustFunction</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">private</span> <span style="color:#ff7b72">readonly</span> bucket: <span style="color:#ff7b72">s3.Bucket</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">constructor</span>(scope: <span style="color:#ff7b72">Construct</span>, id: <span style="color:#ff7b72">string</span>, props?: <span style="color:#ff7b72">cdk.StackProps</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">super</span>(scope, id, props);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">this</span>.bucket <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">new</span> s3.Bucket(<span style="color:#ff7b72">this</span>, <span style="color:#a5d6ff">&#39;HelloRustBucket&#39;</span>, {
</span></span><span style="display:flex;"><span>      enforceSSL: <span style="color:#ff7b72">true</span>,
</span></span><span style="display:flex;"><span>      removalPolicy: <span style="color:#ff7b72">cdk.RemovalPolicy.DESTROY</span>,
</span></span><span style="display:flex;"><span>      autoDeleteObjects: <span style="color:#ff7b72">true</span>
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">this</span>.rustHandler <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">new</span> rust.RustFunction(<span style="color:#ff7b72">this</span>, <span style="color:#a5d6ff">&#39;HelloRust&#39;</span>, {
</span></span><span style="display:flex;"><span>      binaryName<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#39;rust_lambda&#39;</span>,
</span></span><span style="display:flex;"><span>      entry<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#39;rust_lambda&#39;</span>
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">this</span>.bucket.grantReadWrite(<span style="color:#ff7b72">this</span>.rustHandler);
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">this</span>.bucket.addEventNotification(s3.EventType.OBJECT_CREATED, <span style="color:#ff7b72">new</span> s3events.LambdaDestination(<span style="color:#ff7b72">this</span>.rustHandler));
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Whenever an object is created in the S3 bucket, the Rust Lambda function will be triggered, and its invocation event will contain a standard S3 event structure. We plan to implement a Lambda that processes the S3 event, for example, by deleting the object after processing it.</p>
<h2 id="writing-the-rust-lambda">
  Writing the Rust Lambda
  <a class="heading-link" href="#writing-the-rust-lambda">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Our Rust Lambda can use the <a href="https://docs.rs/lambda_runtime/"  class="external-link" target="_blank" rel="noopener"><code>lambda_runtime</code></a> and <a href="https://docs.rs/aws-sdk-s3/"  class="external-link" target="_blank" rel="noopener"><code>aws-sdk-s3</code></a> crates. Here&rsquo;s a simplified example:</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#ff7b72">use</span><span style="color:#6e7681"> </span>aws_config::BehaviorVersion;<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681"></span><span style="color:#ff7b72">use</span><span style="color:#6e7681"> </span>aws_sdk_s3::Client<span style="color:#6e7681"> </span><span style="color:#ff7b72">as</span><span style="color:#6e7681"> </span>S3Client;<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681"></span><span style="color:#ff7b72">use</span><span style="color:#6e7681"> </span>lambda_runtime::{run,<span style="color:#6e7681"> </span>service_fn,<span style="color:#6e7681"> </span>tracing,<span style="color:#6e7681"> </span>Error};<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681"></span><span style="color:#ff7b72">mod</span> <span style="color:#ff7b72">event_handler</span>;<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681"></span><span style="color:#ff7b72">use</span><span style="color:#6e7681"> </span>event_handler::function_handler;<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681"></span><span style="color:#8b949e;font-weight:bold;font-style:italic">#[tokio::main]</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681"></span><span style="color:#ff7b72">async</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">fn</span> <span style="color:#d2a8ff;font-weight:bold">main</span>()<span style="color:#6e7681"> </span>-&gt; Result<span style="color:#ff7b72;font-weight:bold">&lt;</span>(),<span style="color:#6e7681"> </span>Error<span style="color:#ff7b72;font-weight:bold">&gt;</span><span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span>tracing::subscriber::fmt().json().init();<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#ff7b72">let</span><span style="color:#6e7681"> </span>shared_config<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#6e7681"> </span>aws_config::load_defaults(BehaviorVersion::v2025_01_17()).<span style="color:#ff7b72">await</span>;<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#ff7b72">let</span><span style="color:#6e7681"> </span>s3_client<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#6e7681"> </span>S3Client::new(<span style="color:#ff7b72;font-weight:bold">&amp;</span>shared_config);<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span>run(service_fn(<span style="color:#ff7b72;font-weight:bold">|</span>event<span style="color:#ff7b72;font-weight:bold">|</span><span style="color:#6e7681"> </span>function_handler(event,<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:bold">&amp;</span>s3_client))).<span style="color:#ff7b72">await</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681"></span>}<span style="color:#6e7681">
</span></span></span></code></pre></div><p>Let&rsquo;s break this down:</p>
<ul>
<li>The <code>lambda_runtime</code> crate provides a couple of things: <code>run</code>, which is the main entry point for our Lambda function, and <code>service_fn</code>, which allows us to define a handler function that will be called with the event data. The <code>tracing</code> crate is used for <a href="https://github.com/awslabs/aws-lambda-rust-runtime?tab=readme-ov-file#tracing-and-logging"  class="external-link" target="_blank" rel="noopener">logging and more</a>, and we initialize it to output JSON logs.</li>
<li>The <a href="https://docs.rs/aws-config/latest/aws_config/"  class="external-link" target="_blank" rel="noopener"><code>aws_config</code></a> crate provides implementations of region and credential resolution, which are used throughout the AWS SDK for Rust. The <code>aws_sdk_s3</code> crate provides the S3 client that we use to interact with S3. Similarly, if we wanted to use DynamoDB, we would use the <code>aws_sdk_dynamodb</code> crate.</li>
<li>Notice that we are using <a href="https://tokio.rs/"  class="external-link" target="_blank" rel="noopener">tokio</a>, which is an asynchronous runtime for Rust. This allows the <code>main()</code> method to use <code>async</code>/<code>await</code> syntax, which is very useful for I/O-bound tasks like network requests.</li>
<li>Finally, some variables are initialized in the <code>main()</code> method, such as <code>shared_config</code> and <code>s3_client</code>. These variables are <a href="https://docs.aws.amazon.com/lambda/latest/dg/rust-handler.html#rust-shared-state"  class="external-link" target="_blank" rel="noopener">shared</a> across Lambda invocations because they&rsquo;re part of the <a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-runtime-environment.html#runtimes-lifecycle-ib"  class="external-link" target="_blank" rel="noopener">init phase</a>. This is where we want to put our expensive initialization code, as it avoids re-initializing the S3 client on every invocation.</li>
</ul>
<p>The <code>event_handler</code> module contains the logic for processing S3 events and deleting objects. You can see its full implementation in <a href="https://github.com/manmartgarc/cdk-lambda-rust/blob/main/rust_lambda/src/event_handler.rs"  class="external-link" target="_blank" rel="noopener">GitHub</a> — but it&rsquo;s not very complex; it just extracts the bucket name and object key from the S3 event and deletes the object using the S3 client.</p>
<h2 id="building-and-deploying">
  Building and Deploying
  <a class="heading-link" href="#building-and-deploying">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>If you just want to test the Rust code, you can run</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cargo test
</span></span></code></pre></div><p>In Rust, the <a href="https://doc.rust-lang.org/book/ch11-03-test-organization.html"  class="external-link" target="_blank" rel="noopener">convention</a> is to put the unit tests in the same file as the code, inside a <code>#[cfg(test)]</code> module. This means that you can run <code>cargo test</code> to run all the tests in your project, including the ones in the <code>event_handler.rs</code> module.</p>
<h3 id="local-lambda-testing">
  Local Lambda Testing
  <a class="heading-link" href="#local-lambda-testing">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>You can test your Lambda locally using <a href="https://www.cargo-lambda.info/"  class="external-link" target="_blank" rel="noopener">cargo-lambda</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cargo lambda watch
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># In another terminal:</span>
</span></span><span style="display:flex;"><span>cargo lambda invoke -F s3-example.json
</span></span></code></pre></div><blockquote>
<p>Keep in mind that since the Lambda is triggered by S3 events, you will need to provide a valid S3 event payload when invoking the Lambda locally. The <code>--data-example s3-put</code> flag provides a sample S3 PUT event.</p></blockquote>
<p>When we are happy with our Rust code, we can build the Lambda binary and deploy it using CDK:</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cdk deploy
</span></span></code></pre></div><p>The <a href="https://github.com/cdklabs/aws-lambda-rust"  class="external-link" target="_blank" rel="noopener">@cdklabs/aws-lambda-rust</a> CDK construct will handle packaging the Rust binary (using a Docker image with the Rust toolchain) and deploying the stack. The <code>cdk deploy</code> command will also create the S3 bucket and wire it up to the Lambda function. Now you can upload files to the S3 bucket, and the Lambda function will be triggered automatically — you can check the logs in CloudWatch to see the Lambda function processing the S3 events and also deleting the objects after processing them.</p>
<h2 id="architecture">
  Architecture
  <a class="heading-link" href="#architecture">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Before we finish, I want to talk a little about the architecture of our CDK stack — specifically about using S3 events directly to trigger the Lambda function.</p>
<p>This is fine for a simple use case, like this one, where we just want to process S3 events and delete the objects. However, the main drawback of this approach is that any events that fail to be processed by the Lambda function will be lost. This is a serious issue, because <em>everything breaks all the time in production</em>.</p>
<p>A better approach is to use an SQS queue as an intermediary between the S3 bucket and the Lambda function. This way, we can gracefully handle two main failure modes:</p>
<ol>
<li>Events that are unable to be processed by the Lambda function (e.g., malformed events, or events that the Lambda function cannot handle). We can report back <a href="https://docs.aws.amazon.com/sdk-for-rust/latest/dg/rust_sqs_code_examples.html#serverless_examples"  class="external-link" target="_blank" rel="noopener">batch item failures to SQS</a>, so that even though the Lambda function succeeds, the events are sent back to the SQS queue for reprocessing later. If an event is sent back a certain number of times, we can send it to a dead-letter queue (DLQ) for further investigation.</li>
<li>Events that are not processed by the Lambda function due to a transient error (e.g., network issues, or the Lambda function being throttled). In this case, the SQS queue will automatically retry the event because we don&rsquo;t delete the message from the queue until the Lambda function successfully processes it. This means that we can handle transient errors gracefully, without losing any events.</li>
</ol>
<p>This retry mechanism is built into integrations between SQS and Lambda, so you don&rsquo;t have to implement it yourself. You can also use the <a href="https://docs.rs/aws-sdk-sqs/latest/aws_sdk_sqs/"  class="external-link" target="_blank" rel="noopener">AWS SDK for Rust</a> to send messages to the SQS queue from your Rust Lambda function, if you need to.</p>
<h2 id="conclusion">
  Conclusion
  <a class="heading-link" href="#conclusion">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>With AWS CDK and the Rust Lambda ecosystem, you can quickly get started building high-performance serverless applications. The developer workflow is smooth: write your Lambda in Rust, define your infrastructure in TypeScript, and let CDK handle the rest!</p>
<p>🦀 Happy building 🦀</p>

      </div>


      <footer>
        


        <div id="disqus_thread"></div>
<script>
  window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "https-manmartgarc-github-io" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
    
    document.addEventListener('themeChanged', function (e) { 
        if (document.readyState == 'complete') {
          DISQUS.reset({ reload: true, config: disqus_config });
        }
    });
</script>
        
        
        
        
        
        
      </footer>
    </article>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css"
    integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">
  
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"
    integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js"
    integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
    onload="renderMathInElement(document.body,
      {
        delimiters: [
          {left: '$$', right: '$$', display:true},
          {left: '$', right: '$', display:false},
          {left: '\\(', right: '\\)', display: false},
          {left: '\\[', right: '\\]', display: true}
        ]
      }
    );"></script>
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
      2023 -
    
    2025
     Manuel Martinez 
    ·
    
      Licensed under <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA-4.0</a>
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js" integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
  

  

  


  

  

  

  

  

  

  

  

  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NJLM0F56ZC"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NJLM0F56ZC');
</script>


  

  

  

  

  

  

  

  
</body>
</html>
